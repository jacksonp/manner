<!DOCTYPE html>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="man-page-info" data-extra1="PCP" data-extra2="Performance Co-Pilot" data-extra3="">
<title>PMLOGCONF</title>
<h1>PMLOGCONF</h1>
<section>
  <h2>NAME</h2>
  <p><strong>pmlogconf</strong> - create/edit a pmlogger configuration file
</section>
<section>
  <h2>SYNOPSIS</h2>
  <p><strong>pmlogconf</strong> [<strong>-cqrv</strong>] [<strong>-d</strong> <em>groupsdir</em>] [<strong>-h</strong> <em>hostname</em>] <em>configfile</em>
</section>
<section>
  <h2>DESCRIPTION</h2>
  <p><strong>pmlogconf</strong> may be used to create and modify a generic configuration file for the PCP archive logger, <strong>pmlogger</strong>(1).
  <p>If <em>configfile</em> does not exist, <strong>pmlogconf</strong> will create a generic configuration file with a default set of enabled metrics and logging intervals.
  <p>Once created, <em>configfile</em> may be used with the <strong>-c</strong> option to <strong>pmlogger</strong>(1) to select performance metrics and specify logging intervals for a PCP archive.
  <p>If <em>configfile</em> does exist, <strong>pmlogconf</strong> will prompt for input from the user to enable or disable groups of related performance metrics and to control the logging interval for each enabled group.
  <p>Group selection requires a simple <strong>y</strong> (yes) or <strong>n</strong> (no) response to the prompt <strong>Log this group?</strong>.
  <p>Other responses at this point may be used to select additional control functions as follows:
  <dl class="indent-64">
    <dt><strong>m</strong>
    <dd>
      <p>Report the names of the metrics in the current group.
    <dt><strong>q</strong>
    <dd>
      <p>Finish with group selection (quit) and make no further changes to this group or any subsequent group.
    <dt><strong>/</strong><em>pattern</em>
    <dd>
      <p>Make no change to this group but search for a group containing <em>pattern</em> in the description of the group or the names of the associated metrics.
  </dl>
  <p>A logging interval is specified by responding to the <strong>Logging interval?</strong> prompt with the keywords <strong>once</strong> or <strong>default</strong> or a valid <strong>pmlogger</strong>(1) interval specification of the form ``<strong>every</strong> <em>N timeunits</em>'' or simply ``<em>N timeunits ''</em> (the <strong>every</strong> is optional) where <em>N</em> is an unsigned integer and <em>timeunits</em> is one of the keywords <strong>msec</strong>, <strong>millisecond</strong>, <strong>sec</strong>, <strong>second</strong>, <strong>min</strong>, <strong>minute</strong>, <strong>hour</strong> or the plural form of one of the keywords.
  <p>When run from automated logging setup processes, the <strong>-c</strong> option is used to add a message and timestamp indicating this fact. This option is not appropriate for interactive use of the tool.
  <p>The <strong>-q</strong> option suppresses the logging interval dialog and preserves the current interval from <em>configfile</em>.
  <p>More verbose output may be enabled with the <strong>-v</strong> option.
</section>
<section>
  <h2>SETUP GROUP FILES</h2>
  <p>When an initial <em>configfile</em> is created, the default specifications come from a set of group files below the <em>groupsdir</em> specified with the <strong>-d</strong> option (the default <em>groupsdir</em> is <strong>$PCP_VAR_DIR/config/pmlogconf</strong> which is most commonly correct, so the <strong>-d</strong> option is rarely used in practice).
  <p>The directory structure below <em>groupsdir</em> is arbitrary as all regular files will be found by recursive descent and considered, so add-on products and PMDA developers can easily extend the available defaults to <strong>pmlogconf</strong> by adding new directories and/or group files below <em>groupsdir</em>.
  <p>These group files are processed in the following ways:
  <dl class="indent-19">
    <dt>·
    <dd>
      <p>When a new <em>configfile</em> is created, all group files are processed.
    <dt>·
    <dd>
      <p>Whenever <strong>pmlogconf</strong> is run with an existing <em>configfile</em>, <em>groupsdir</em> is traversed to see if any new groups have been defined and should be considered for inclusion in <em>configfile</em>.
    <dt>·
    <dd>
      <p>When <strong>pmlogconf</strong> processes a group in <em>configfile</em> that is enabled, the list of metrics associated with the group is taken from the group file (and replaces any previous list of metrics associated with this group in <em>configfile</em>).
    <dt>·
    <dd>
      <p>When the <strong>-r</strong> (reprobe) command line option is specified, every group (not just newly discovered ones) is reprocessed to see if it should be considered for inclusion in <em>configfile</em>.
  </dl>
  <p>Each group file is structured as follows:
  <dl class="indent-19">
    <dt>·
    <dd>
      <p>The first line must contain <strong>#pmlogconf-setup 2.0</strong>
    <dt>·
    <dd>
      <p>Other lines beginning with <strong>#</strong> are treated as comments.
    <dt>·
    <dd>
      <p>Blank lines are ignored.
    <dt>·
    <dd>
      <p>One or more lines starting with the keyword <strong>ident</strong> are used to provide the human-readable description of the group.
    <dt>·
    <dd>
      <p>Non-blank lines beginning with white space define metrics to be associated with this group, one per line. &nbsp;Each metric specification follows the rules for a <strong>pmlogger</strong>(1) configuration, namely either the name of a non-leaf node in the PMNS (implying all descendent names in the PMNS), or the name of a leaf node in the PMNS optionally followed by one or more instance names enclosed by ``['' and ``]''.
    <dt>·
    <dd>
      <p>A control line starting with one of the keywords <strong>probe</strong> or <strong>force</strong> must be present.
    <dt>·
    <dd>
      <p>An optional logging interval control line begins with the keyword <strong>delta</strong> followed by one of the <strong>pmlogger</strong>(1) interval specification described above.
    <dt>·
    <dd>
      <p><strong>probe</strong> control lines have the format:
      <div class="indent-19">
        <p class="center"><strong>probe</strong> <em>metric</em> [<em>condition</em> [<em>state_rule</em>] ]
        <p>where <em>metric</em> is the name of a PCP metric (must be a leaf node in the PMNS, no instance specification is allowed, and it must not be a derived metric) and the optional <em>condition</em> is the keyword <strong>exists</strong> (true if <em>metric</em> exists, i.e. is defined in the PMNS) or the keyword <strong>values</strong> (true if <em>metric</em> exists in the PMNS and has one or more current values) or an expression of the form
        <p class="center"><em>op</em> <em>val</em>
        <p>where <em>op</em> is one of the <strong>awk</strong>(1) operators (<strong>==</strong>, <strong>!=</strong>, <strong>&gt;</strong>, <strong>&gt;=</strong>, <strong>&lt;</strong>, <strong>&lt;=</strong>, <strong>~</strong> (regular expression match) or <strong>!~</strong> (negated regular expression match)) and <em>val</em> is a value (arbitrary sequence of characters, excluding a space) and the <em>condition</em> is true if there is some instance of <em>metric</em> that makes the expression true.
        <p>If the <em>condition</em> is missing, the default is <strong>exists</strong>.
        <p>When an explicit <em>condition</em> is provided, there may also be an optional <em>state_rule</em> of the form
        <p class="center"><strong>?</strong> <em>true_state</em> <strong>:</strong> <em>false_state</em>
        <p>where <em>true_state</em> (applies if <em>condition</em> is true) and <em>false_state</em> (applies if <em>condition</em> is false) are both taken from the keywords <strong>include</strong> (include and enable the group and the associated metrics in <em>configfile</em>), <strong>available</strong> (include and disable the group in <em>configfile</em> - a user action of <strong>y</strong> as described above is needed to enable the group and add the associated metrics into <em>configfile</em>) or <strong>exclude</strong> (the group is not considered for inclusion in <em>configfile</em>).
        <p>The default <em>state_rule</em> is
        <p class="center"><strong>? available : exclude</strong>
      </div>
    <dt>·
    <dd>
      <p><strong>force</strong> control lines begin with the keyword <strong>force</strong> followed by one of the states defined above, so one of the actions <strong>include</strong>, <strong>exclude</strong> or <strong>available</strong> is applied unconditionally to the group.
  </dl>
  <p>Probing is only done when a new group is being added to <em>configfile</em> or when the <strong>-r</strong> command line option is specified. &nbsp;The evaluation of the probing conditions is done by contacting <strong>pmcd</strong>(1) on <em>hostname</em> (defaults to local:).
</section>
<section>
  <h2>EXAMPLE</h2>
  <p>The following group file demonstrates all of the supported syntactic elements.
  <pre>#pmlogconf-setup 2.0
ident   Example group file
ident   ... more description
delta   1 minute
probe   sample.secret.foo.one values ? include : exclude
        sample.secret.foo.one
        sample.secret.foo.bar   # non-leaf in the PMNS
        sample.colour [ red green ]</pre>
</section>
<section>
  <h2>MIGRATION</h2>
  <p>The current version of <strong>pmlogconf</strong> (2.0) supports a slightly different format for <em>configfile</em> compared to earlier versions. &nbsp;If an old version <em>configfile</em> is presented to <strong>pmlogconf</strong> it will be converted to the new format.
</section>
<section>
  <h2>PCP ENVIRONMENT</h2>
  <p>Environment variables with the prefix <strong>PCP_</strong> are used to parameterize the file and directory names used by PCP. On each installation, the file <em>/etc/pcp.conf</em> contains the local values for these variables. The <strong>$PCP_CONF</strong> variable may be used to specify an alternative configuration file, as described in <strong>pcp.conf</strong>(5). Note that <strong>pmlogconf</strong> specifically overrides its own <strong>$PCP_DERIVED_CONFIG</strong> environment variable to an empty string, for performance reasons.
</section>
<section>
  <h2>SEE ALSO</h2>
  <p><strong>pmcd</strong>(1), <strong>pmlogger</strong>(1), <strong>pcp.conf</strong>(5) and <strong>pcp.env</strong>(5).
</section>

