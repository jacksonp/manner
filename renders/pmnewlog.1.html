<!DOCTYPE html>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="man-page-info" data-date="PCP" data-package="Performance Co-Pilot" data-section-name="">
<title>PMNEWLOG</title>
<h1>PMNEWLOG</h1>
<div class="section">
  <h2>NAME</h2>
  <p><strong>pmnewlog</strong> - stop and restart archive logging for PCP performance metrics
</div>
<div class="section">
  <h2>SYNOPSIS</h2>
  <p><strong>$PCP_BINADM_DIR/pmnewlog</strong> [<strong>-a</strong> <em>accessfile</em>] [<strong>-C</strong> <em>saveconfig</em>] [<strong>-c</strong> <em>configfile</em>] [<strong>-N</strong>] [<strong>-n</strong> <em>pmnsfile</em>] [<strong>-P</strong>] [<strong>-p</strong> <em>pid</em>] [<strong>-s</strong>] [<strong>-V</strong>] [<em>other pmlogger options</em>] <em>archive</em>
</div>
<div class="section">
  <h2>DESCRIPTION</h2>
  <p><strong>pmnewlog</strong> may be used to stop and restart a running instance of <strong>pmlogger</strong>(1). This is most useful for managing multiple sets of Performance Co-Pilot (PCP) archive logs. These archive logs record the history of performance metric values that may be “played back” by other PCP tools, and they form the basis of the VCR paradigm and retrospective performance analysis services common to the PCP toolkit.
  <p>In normal usage, <strong>pmnewlog</strong> would be executed by <strong>cron</strong>(1) in the wee hours to terminate one PCP archive log and start another, i.e. to perform log rotation.
  <p>Even more common, would be the execution of <strong>pmnewlog</strong> from the PCP archive management script <strong>pmlogger_daily</strong>(1). In this case, direct end-user execution of <strong>pmnewlog</strong> is most unlikely.
  <p>The mandatory argument <em>archive</em> is the base name for the physical files that will constitute the new archive log.
  <p>The <strong>pmlogger</strong> instance to be stopped and restarted must be running on the same system as <strong>pmnewlog</strong> and is either the primary logger (the default) or the logger with <em>pid</em> as specified by the <strong>-p</strong> option.
  <p>If the <strong>-n</strong> option is specified, then <strong>pmnewlog</strong> will use the namespace in the <em>pmnsfile</em>, rather than the default Performance Metrics Name Space (PMNS).
  <p>If no <strong>-c</strong> option is specified, <strong>pmnewlog</strong> will use <strong>pmlc</strong>(1) to connect to the running <strong>pmlogger</strong>(1) and so determine all those metrics and instances that are subject to <strong>mandatory</strong> logging or <strong>advisory on</strong> logging, and the associated logging frequencies. This information is used to synthesize a new <strong>pmlogger</strong>(1) configuration file. If the <strong>-n</strong> option is specified, it will also be used for these interactions with <strong>pmlc</strong>(1).
  <p>If the <strong>-c</strong> option is specified, <strong>pmlogger</strong>(1) will be restarted with <em>configfile</em> as the configuration file. Normally <em>configfile</em> would be the same configuration file used to start <strong>pmlogger</strong>(1) in the first place, however note that since <strong>pmlogger</strong>(1) is restarted, any changes to the logging status made using <strong>pmlc</strong>(1) will be lost, unless these have also been reflected in changes to <em>configfile</em>.
  <p>If <em>configfile</em> does not exist, then a search is made in the directory <em>$PCP_VAR_DIR/config/pmlogger</em> for a file of the same name, and if found that file is used, e.g. if <em>config.mumble</em> does not exist in the current directory and the file <em>$PCP_VAR_DIR/config/pmlogger/config.mumble</em> does exist, then <strong>-c config.mumble</strong> and <strong>-c $PCP_VAR_DIR/config/pmlogger/config.mumble</strong> are equivalent.
  <p>Access controls specifications for the new <strong>pmlogger</strong>(1) instance may optionally be provided via the <strong>-a</strong> option. The contents of <em>accessfile</em> should start with the literal token <strong>[access]</strong> and conform to the syntax of the access controls section as described for <strong>pmlogger</strong>(1).
  <p>The <strong>-C</strong> option may be used to save the configuration file that <strong>pmnewlog</strong> passes to the newly launched <strong>pmlogger</strong>(1).
  <p>If the <strong>pmlogger</strong>(1) instance needs to be started under the control of <strong>pmsocks</strong>(1) to connect to a <strong>pmcd</strong> through a firewall, the <strong>-s</strong> option may be used.
  <p>The <strong>-V</strong> option enables verbose reporting of the activity. By default no output is generated unless some error or warning condition is encountered.
  <p>The <strong>-N</strong> option enables a “show me” mode, where the actions are echoed, but not executed, in the style of “make -n”. Using <strong>-N</strong> in conjunction with <strong>-V</strong> maximizes the diagnostic capabilities for debugging.
  <p>The <em>other pmlogger options</em> are as described for <strong>pmlogger</strong>(1). Note that <strong>pmnewlog</strong> does <strong>not</strong> support the following options of <strong>pmlogger</strong>(1).
  <dl>
    <dt><strong>-h</strong> <em>host</em>
    <dd>
      <p><strong>pmnewlog</strong> determines the host to which the new <strong>pmlogger</strong>(1) should connect based upon the current host connection for the old <strong>pmlogger</strong>(1).
    <dt><strong>-s</strong> <em>samples</em>
    <dd>
      <p>The new <strong>pmlogger</strong>(1) is expected to be long running, and the <strong>-s</strong> option of <strong>pmnewlog</strong> takes precedence.
    <dt><strong>-T</strong> <em>runtime</em>
    <dd>
      <p>The new <strong>pmlogger</strong>(1) is expected to be long running
    <dt><strong>-V</strong> <em>version</em>
    <dd>
      <p>The new <strong>pmlogger</strong> will always create the latest version PCP archive format, and the <strong>-V</strong> option of <strong>pmnewlog</strong> takes precedence.
    <dt><strong>-x</strong> <em>fd</em>
    <dd>
      <p>The launched <strong>pmlogger</strong> cannot be controlled by <strong>pmRecordControl</strong>(3).
  </dl>
</div>
<div class="section">
  <h2>EXAMPLE</h2>
  <p>The following <strong>sh</strong>(1) script could be executed by root via <strong>cron</strong>(1) to start a new set of archive logs for the primary logger each evening. A more complete version of this script may be found in <em>$PCP_BINADM_DIR/pmlogger_daily</em>, and is documented in the manual page for <strong>pmlogger_daily</strong>(1).
  <pre>#!/bin/sh
# start new logs for PCP primary logger on this host

# standard place for logs
LOGDIR=$PCP_LOG_DIR/pmlogger/`hostname`

# each new log is named yymmdd.hh.mm
LOGNAME=`date "+%Y%m%d.%H.%M"`

# do it
[ ! -d $LOGDIR ] &amp;& mkdir -p $LOGDIR
cd $LOGDIR
$PCP_BINADM_DIR/pmnewlog -l $LOGDIR/pmlogger.log $LOGDIR
</pre>
</div>
<div class="section">
  <h2>FILES</h2>
  <dl class="indent-10">
    <dt><em>archive</em><strong>.meta</strong>
    <dd>
      <p>metadata (metric descriptions, instance domains, etc.) for the archive log
    <dt><em>archive</em><strong>.0</strong>
    <dd>
      <p>initial volume of metrics values (subsequent volumes have suffixes <strong>1</strong>, <strong>2</strong>, ...)
    <dt><em>archive</em><strong>.index</strong>
    <dd>
      <p>temporal index to support rapid random access to the other files in the archive log
    <dt><strong>$PCP_BINADM_DIR/pmlogger_daily</strong>
    <dd>
      <p>sample script to rotate archives for a number of loggers
  </dl>
</div>
<div class="section">
  <h2>PCP ENVIRONMENT</h2>
  <p>Environment variables with the prefix <strong>PCP_</strong> are used to parameterize the file and directory names used by PCP. On each installation, the file <em>/etc/pcp.conf</em> contains the local values for these variables. The <strong>$PCP_CONF</strong> variable may be used to specify an alternative configuration file, as described in <strong>pcp.conf</strong>(5).
</div>
<div class="section">
  <h2>SEE ALSO</h2>
  <p><strong>PCPIntro</strong>(1), <strong>pmcd</strong>(1), <strong>pmdumplog</strong>(1), <strong>pmlc</strong>(1), <strong>pmlogger</strong>(1), <strong>pmlogger_daily</strong>(1), <strong>pmsocks</strong>(1), <strong>pcp.conf</strong>(5) and <strong>pcp.env</strong>(5).
</div>
<div class="section">
  <h2>DIAGNOSTICS</h2>
  <p>Due to the precious nature of the archive logs, <strong>pmnewlog</strong> is rather paranoid in its checking and validation, and will try very hard to ensure that an appropriately configured <strong>pmlogger</strong>(1) can be restarted, before terminating the existing <strong>pmlogger</strong>(1).
  <p>As a consequence of this checking, <strong>pmnewlog</strong> tends to generate rather verbose error and warning messages.
</div>
<div class="section">
  <h2>CAVEATS</h2>
  <p>If no <em>configfile</em> is specified, the method for synthesizing a configuration file using a <strong>pmlc</strong>(1) connection to the existing <strong>pmlogger</strong>(1) is, of necessity, incomplete. In particular, for metrics with dynamic underlying instance domains, it is not possible to identify a configuration that logs <strong>all</strong> instances of a metric all of the time, so rather the synthesized configuration file requests the continued logging of the set of instances that exist at the time <strong>pmlogger</strong>(1) is interrogated by <strong>pmnewlog</strong>.
  <p>If this situation is a concern, a fixed configuration file should be used, and passed to <strong>pmnewlog</strong> via the <strong>-c</strong> option.
</div>

