<!DOCTYPE html>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="man-page-info" data-extra1="PCP" data-extra2="Performance Co-Pilot" data-extra3="">
<title>PMSOCKS</title>
<h1>PMSOCKS</h1>
<div class="section">
  <h2>NAME</h2>
  <p><strong>pmsocks</strong> - shell wrapper for performance monitoring across firewalls
</div>
<div class="section">
  <h2>SYNOPSIS</h2>
  <p><strong>pmsocks</strong> <em>path</em> [<em>args</em> ...]
</div>
<div class="section">
  <h2>DESCRIPTION</h2>
  <p><strong>pmsocks</strong> allows Performance Co-Pilot (PCP) clients running on hosts located on the internal side of a TCP/IP firewall to monitor remote hosts on the other side of the firewall. This assumes the firewall has been configured with a compliant <strong>sockd</strong> daemon and the necessary access controls are satisfied.
</div>
<div class="section">
  <h2>CONFIGURATION</h2>
  <p><strong>pmsocks</strong> uses the <strong>tsocks</strong>(5) library, which is not included with PCP. You can get <strong>tsocks</strong> from <em>http://www.progsoc.uts.edu.au/~delius/</em>.
</div>
<div class="section">
  <h2>IRIX CONFIGURATION</h2>
  <p>On IRIX, <strong>pmsocks</strong> is simply a shell wrapper that sets the appropriate environment variables and then executes the <em>path</em> program with <em>args</em> arguments (if any). <strong>pmsocks</strong> works by setting the <strong>_RLD_LIST</strong> environment variable (see <strong>rld</strong>(1)) to load a dynamic shared library (see <strong>dso</strong>(5)) containing stubs for “socksified” network library functions; This “socksified” library is installed at <em>/usr/pcp/lib/libpcp_socks.so</em>.
  <p>There are a number of conditions required for this to be successful and the user is strongly advised to read this whole manual page (in particular the <strong>CAVEAT</strong> section below) before attempting to use <strong>pmsocks</strong>.
  <p>When <strong>pmsocks</strong> is installed, the <em>/etc/pcp_socks.conf</em> configuration file is also installed with minimum default settings. These settings specify that socket connections to the local host should be made directly, without contacting any socks server daemon. This is necessary so that PCP clients will be able to establish a local connection to the <strong>X</strong>(1) server, and use PCP connections, possibly via a <strong>sockd</strong> daemon, to monitor remote hosts. In the present implementation of <strong>pmsocks</strong>, non-direct connections to the <strong>X</strong>(1) server do not work, hence if the display is remote, then the remote host must be on the same side of the firewall and <em>/etc/pcp_socks.conf</em> must be configured to connect directly to that host.
  <p>The format of <em>/etc/pcp_socks.conf</em> is identical to <em>/etc/socks.conf</em> as documented in the <em>CSTC-4.2</em> socks distribution. This distribution may be obtained via information contained in the socks FAQ at
  <div class="center">
    <p>ftp://coast.cs.purdue.edu/pub/tools/unix/socks/
  </div>
  <p>If other socks clients are being used, then it is generally safe to remove <em>/etc/pcp_socks.conf</em> and instead make a symbolic link to <em>/etc/socks.conf</em>. The file formats are identical.
  <p>The default configuration should be customized to suit the local environment so that connections to hosts located on the same side of the firewall as the local host do not use the socks daemon unnecessarily. The default configuration is<br>
  <br>
  direct LOCALHOSTNAME 255.255.255.255 # direct localhost<br>
  sockd 0.0.0.0 0.0.0.0 # contact sockd everywhere else<br>
  <br>
  Note that the string <strong>LOCALHOSTNAME</strong> is dynamically substituted at run time with the name of the local host, as obtained by a call to <strong>gethostname</strong>(2). Assuming the real IP address of the local host is <strong>1.2.3.4</strong> and that a normal class-c subnet is used locally, the most common customization would be to specify direct connections for all hosts on the local subnet, by inserting another “direct” line as follows:<br>
  <br>
  direct LOCALHOSTNAME 255.255.255.255 # direct localhost<br>
  direct 1.2.3.0 255.255.255.0 # direct on local subnet<br>
  sockd 0.0.0.0 0.0.0.0 # contact sockd everywhere else
  <p>The order of lines is important - the first line matching the requested destination IP address during a <strong>connect</strong>(2) call (after the requested IP address has been masked by the third parameter of the <em>/etc/pcp_socks.conf</em> line), specifies via the first parameter whether to contact the socks daemon or whether to attempt a direct connection.
</div>
<div class="section">
  <h2>IRIX ENVIRONMENT VARIABLES</h2>
  <p>There are several environment variables used by <strong>pmsocks</strong> as follows:
  <dl class="indent-10">
    <dt><strong>SOCKS_SERVER</strong>
    <dd>Specifies the host name or IP address of the host running the <strong>sockd</strong> daemon. Usually this is the name of the firewall host.
    <dt><strong>SOCKS_PORT</strong>
    <dd>The TCP/IP port to use when contacting <strong>sockd</strong> on the <strong>SOCKS_SERVER</strong> host. The default is <strong>1080</strong>.
    <dt><strong>SOCKS_NS</strong>
    <dd>The host name of the name server to use, usually to resolve the IP address of <strong>SOCKS_SERVER</strong>.
    <dt><strong>SOCKS_DEBUG</strong>
    <dd>If present in the environment, <strong>libpcp_socks</strong> will print debugging information to the <em>stderr</em> stream. There are only two levels of debugging, on or off. This is only really useful for the developers because the debugging information assumes knowledge of the <strong>libpcp_socks</strong> source code.
    <dt><strong>SOCKS_BANNER</strong>
    <dd>If this is set, whenever a client calls <strong>libpcp_socks</strong> it will echo a message to <em>stdout</em> containing version information. This can be useful to check <strong>libpcp_socks</strong> is working in the absence of verbose logging.
    <dt><strong>_RLD_LIST</strong>
    <dd><strong>pmsocks</strong> sets this to exactly <strong>/usr/pcp/lib/libpcp_socks.so:DEFAULT</strong><br>
    It is strongly recommended this NOT be set in the environment of interactive shells.
    <dt><strong>PMCD_CONNECT_TIMEOUT</strong>
    <dd>Specifies the time-out, in seconds, for connections to <strong>pmcd</strong>(1). When using <strong>pmsocks</strong>, this may need to be increased from the default (5 seconds) due to the additional delays introduced as a result of using <strong>sockd</strong>. See <strong>PMAPI</strong>(3) for further details about this variable.
  </dl>
</div>
<div class="section">
  <h2>CAVEAT</h2>
  <p>The following notes should be considered carefully:
  <dl class="indent-5">
    <dt>0)
    <dd>Because <strong>sockd</strong> can only handle TCP/IP sockets, <strong>pmsocks</strong> never attempts to use <strong>sockd</strong> for sockets of type <strong>SOCK_DGRAM</strong> or if the <strong>domain</strong> parameter in a call to <strong>socket</strong>(2) is <strong>PF_UNIX</strong> (unix domain sockets should never need to use <strong>sockd</strong> anyway).
    <dt>1)
    <dd>Some firewall products do not support “socksified” applications, and in these cases, <strong>pmsocks</strong> cannot be used. In this case, it will be necessary to configure the firewall to allow connections through the firewall for the PMCD communications port, typically tcp/4321.
    <dt>2)
    <dd>The PCP protocol is TPC/IP-based and works with the socks protocol, but connections which use UDP/DATAGRAM sockets or remote X11 connections via <strong>sockd</strong> may not work. If the remote display host is on the same side of the firewall as the application, this may be circumvented by configuring the remote display host to use direct connections - see above. Also, using X11 display options which use shared memory may hang the X server when used with <strong>pmsocks</strong>.
    <dt>3)
    <dd>If the <strong>pmsocks</strong> configuration file is not present, then <strong>pmsocks</strong> will exit with an error message.
    <dt>4)
    <dd><strong>pmsocks</strong> uses the locally configured name server or resolver (see <strong>resolver</strong>(5)) to resolve host names to IP addresses. This may or may not be capable of resolving host names on the other side of the firewall.
    <dt>5)
    <dd>When used over a WAN, often the <strong>sockd</strong> daemon will be a long way from the application. This may result in PCP client connections timing out before connecting to the remote <strong>pmcd</strong>. If this is occurring, set the environment variable <strong>PMCD_CONNECT_TIMEOUT</strong> to a higher value than the default (5 seconds). Refer to <strong>PMAPI</strong>(3) for further details about this variable.
    <dt>6)
    <dd>When using <strong>pmsocks</strong> to connect to <strong>pmcd</strong>(1), but <em>“Connection Refused”</em> error messages are returned, it is not immediately obvious whether <strong>pmcd</strong>(1) is returning the error or <strong>sockd</strong>.
  </dl>
</div>
<div class="section">
  <h2>COPYRIGHT NOTICE</h2>
  <p><strong>tsocks</strong> is covered by the GPL license and is copyright Shaun Clowes (delius@progsoc.org).
</div>
<div class="section">
  <h2>FILES</h2>
  <dl class="indent-10">
    <dt><strong>/etc/tsocks.conf</strong>
    <dd>configuration file
  </dl>
</div>
<div class="section">
  <h2>SEE ALSO</h2>
  <p><strong>pmcd</strong>(1), <strong>pminfo</strong>(1), <strong>pmlogger</strong>(1), <strong>pmval</strong>(1), <strong>X</strong>(1), <strong>PMAPI</strong>(3), <strong>resolver</strong>(5), and <strong>tsocks</strong>(5).
</div>

