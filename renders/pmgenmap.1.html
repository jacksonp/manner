<!DOCTYPE html>
<meta charset="utf-8">
<meta name="man-page-info" data-extra1="PCP" data-extra2="Performance Co-Pilot" data-extra3="">
<title>PMGENMAP</title>
<h1>PMGENMAP</h1>
<section>
  <h2>NAME</h2>
  <p><strong>pmgenmap</strong> - generate C code to simplify handling of performance metrics
</section>
<section>
  <h2>SYNOPSIS</h2>
  <p><strong>pmgenmap</strong> [<em>infile</em>]
</section>
<section>
  <h2>DESCRIPTION</h2>
  <p>Given one or more lists of metric names in <em>infile</em> or on standard input, <strong>pmgenmap</strong> generates C declarations and <strong>cpp</strong>(1) macros suitable for use across the Performance Metrics Programming Interface (PMAPI) on standard output.
  <p>The declarations produced by <strong>pmgenmap</strong> simplify the coding for client applications using the PMAPI.
  <p>The input should consist of one or more lists of metric names of the form
  <pre><code>listname {</code>
<code>    metricname1 symbolname1</code>
<code>    metricname2 symbolname2</code>
<code>    ...</code>
<code>}</code></pre>
  <p>which will generate C and <strong>cpp</strong>(1) declarations of the form
  <pre><code>char *listname[] = {</code>
<code>#define symbolname1 0</code>
<code>    "metricname1",</code>
<code>#define symbolname2 1</code>
<code>    "metricname2",</code>
<code>    ...</code>
<code>};</code></pre>
  <p>The array declarations produced are suitable as parameters to <strong>pmLookupName</strong>(3) and the <strong>#define</strong>d constants may be used to index the <em>vset</em>s in the <em>pmResult</em> structure returned by a <strong>pmFetch</strong>(3) call.
  <p>Obviously, <em>listname</em> must conform to the C identifier naming rules, each <em>symbolname</em> must conform to the <strong>cpp</strong>(1) macro naming rules, and each <em>metricname</em> is expected to be a valid performance metrics name (see <strong>pmns</strong>(5) for more details).
  <p>The input may include <strong>sh</strong>-style comment lines, i.e. with a `<strong>#</strong>' as the first non-blank character of a line, and these are translated on output to either single line or multi-line C comments in the K&amp;R style. &nbsp;For example, the input:
  <pre><code># leading block of multi-line comments</code>
<code># initialization group</code>
<code>foo {</code>
<code>        a.b.c   ONE</code>
<code>        d.e.f.g TWO</code>
<code>        # embedded block of multi-lines</code>
<code>        # comments and boring pad text</code>
<code>        xx.yy.zz        THREE</code>
<code>}</code>

<code># trailing single line comment</code></pre>
  <p>Produces the output:
  <pre><code>/*</code>
<code> * leading block of multi-line comments</code>
<code> * initialization group</code>
<code> */</code>
<code>char *foo[] = {</code>
<code>#define ONE 0</code>
<code>        "a.b.c",</code>
<code>#define TWO 1</code>
<code>        "d.e.f.g",</code>
<code>/*</code>
<code> * embedded block of multi-lines</code>
<code> * comments and boring pad text</code>
<code> */</code>
<code>#define THREE 2</code>
<code>        "xx.yy.zz",</code>

<code>};</code>


<code>/* trailing single line comment */</code></pre>
</section>
<section>
  <h2>EXAMPLE</h2>
  <p>For brevity we have removed the error handling code, and assumed the chosen metrics do not have multiple values.
  <p>The input file
  <pre><code>mystats {</code>
<code>    kernel.percpu.cpu.idle     IDLE</code>
<code>    kernel.percpu.cpu.sys      SYS</code>
<code>    kernel.percpu.cpu.user     USER</code>
<code>    hinv.ncpu                       NCPU</code>
<code>}</code></pre>
  <p>produces the following C code, suitable for <strong>#include</strong>-ing
  <pre><code>/*</code>
<code> * Performance Metrics Name Space Map</code>
<code> * Built by pmgenmap from the file</code>
<code> * mystats.metrics</code>
<code> * on Wed Dec 28 19:44:17 EST 1994</code>
<code> *</code>
<code> * Do not edit this file!</code>
<code> */</code>

<code>char *mystats[] = {</code>
<code>#define IDLE    0</code>
<code>        "kernel.percpu.cpu.idle",</code>
<code>#define SYS     1</code>
<code>        "kernel.percpu.cpu.sys",</code>
<code>#define USER    2</code>
<code>        "kernel.percpu.cpu.user",</code>
<code>#define NCPU    3</code>
<code>        "hinv.ncpu",</code>

<code>};</code></pre>
  <p>Using the code generated by <strong>pmgenmap</strong>, we are now able to easily obtain metrics from the Performance Metrics Collection Subsystem (PMCS) as follows:
  <pre><code>#define MAX_PMID 4</code>

<code>    int         trip = 0;</code>
<code>    int         numpmid = sizeof(mystats)/sizeof(mystats[0]);</code>
<code>    double      duration;</code>
<code>    pmResult    *resp;</code>
<code>    pmResult    *prev;</code>
<code>    pmID        pmidlist[MAX_PMID];</code>

<code>    pmNewContext(PM_CONTEXT_HOST, "localhost");</code>
<code>    pmLookupName(numpmid, mystats, pmidlist);</code>
<code>    pmFetch(numpmid, pmidlist, &amp;resp);</code>

<code>    printf("%d CPUs: %d usr   %d sys   %d   idle0,</code> 
<code>           resp-&gt;vset[NCPU]-&gt;vlist[0].value.lval,</code>
<code>           resp-&gt;vset[USER]-&gt;vlist[0].value.lval,</code>
<code>           resp-&gt;vset[SYS]-&gt;vlist[0].value.lval,</code>
<code>           resp-&gt;vset[IDLE]-&gt;vlist[0].value.lval);</code></pre>
  <p>Some calls to ensure portability have been removed from the code above for the sake of clarity - the example above should not be used as a template for programming. &nbsp;In particular, the raw values of the metrics were used when <strong>pmLookupDesc</strong>(3) should have been called to determine the semantics of each metric.
  <p>More complete examples that demonstrate the use of <strong>pmgenmap</strong> which may be used as a basis for program development are included in the PCP demos, e.g. <em>$PCP_DEMOS_DIR/pmclient</em>.
</section>
<section>
  <h2>FILES</h2>
  <dl>
    <dt><strong>$PCP_VAR_DIR/pmns/</strong><em>*</em>
    <dd>
      <p>default PMNS specification files
  </dl>
</section>
<section>
  <h2>PCP ENVIRONMENT</h2>
  <p>Environment variables with the prefix <strong>PCP_</strong> are used to parameterize the file and directory names used by PCP. On each installation, the file <em>/etc/pcp.conf</em> contains the local values for these variables. The <strong>$PCP_CONF</strong> variable may be used to specify an alternative configuration file, as described in <strong>pcp.conf</strong>(5).
</section>
<section>
  <h2>SEE ALSO</h2>
  <p><strong>cpp</strong>(1), <strong>PMAPI</strong>(3), <strong>pmFetch</strong>(3), <strong>pmLookupName</strong>(3), <strong>pmNewContext</strong>(3), <strong>pcp.conf</strong>(5), <strong>pcp.env</strong>(5) and <strong>pmns</strong>(5).
</section>

