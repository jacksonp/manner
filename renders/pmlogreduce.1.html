<!DOCTYPE html>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="man-page-info" data-extra1="PCP" data-extra2="Performance Co-Pilot" data-extra3="">
<title>PMLOGREDUCE</title>
<h1>PMLOGREDUCE</h1>
<section>
  <h2>NAME</h2>
  <p><strong>pmlogreduce</strong> - temporal reduction of Performance Co-Pilot archives
</section>
<section>
  <h2>SYNOPSIS</h2>
  <p><strong>$PCP_BINADM_DIR/pmlogreduce</strong> [<strong>-z</strong>] [<strong>-A</strong> <em>align</em>] [<strong>-S</strong> <em>starttime</em>] [<strong>-s</strong> <em>samples</em>] [<strong>-T</strong> <em>endtime</em>] [<strong>-t</strong> <em>interval</em>] [<strong>-v</strong> <em>volsamples</em>] [<strong>-Z</strong> <em>timezone</em>] <em>input</em> <em>output</em>
</section>
<section>
  <h2>DESCRIPTION</h2>
  <p><strong>pmlogreduce</strong> reads one set of Performance Co-Pilot (PCP) archives identified by <em>input</em> and creates a temporally reduced PCP archive in <em>output</em>. <em>input</em> is a comma-separated list of names, each of which may be the base name of an archive or the name of a directory containing one or more archives. The &nbsp;data reduction involves statistical and temporal reduction of samples with an output sampling interval defined by the <strong>-t</strong> option in the <em>output</em> archive (independent of the sampling intervals in the <em>input</em> archives), and is further controlled by other command line arguments.
  <p>For some metrics, temporal data reduction is not going to be helpful, so for metrics with types <strong>PM_TYPE_AGGREGATE</strong> or <strong>PM_TYPE_EVENT</strong>, a warning is issued if these metrics are found in <em>input</em> and they will be skipped and not appear in the <em>output</em> archive.
</section>
<section>
  <h2>COMMAND LINE OPTIONS</h2>
  <p>The command line options for <strong>pmlogreduce</strong> are as follows:
  <dl class="indent-7">
    <dt><strong>-A</strong> <em>align</em>
    <dd>
      <p>Specify a ``natural'' alignment of the output sample times; refer to <strong>PCPIntro</strong>(1).
    <dt><strong>-S</strong> <em>starttime</em>
    <dd>
      <p>Define the start of a time window to restrict the samples retrieved from the <em>input</em> archives; refer to <strong>PCPIntro</strong>(1).
    <dt><strong>-s</strong> <em>samples</em>
    <dd>
      <p>The argument <em>samples</em> defines the number of samples to be written to <em>output</em>. If <em>samples</em> is 0 or <strong>-s</strong> is not specified, <strong>pmlogreduce</strong> will sample until the end of the set of PCP archives, or the end of the time window as specified by <strong>-T</strong>, whichever comes first. &nbsp;The <strong>-s</strong> option will override the <strong>-T</strong> option if it occurs sooner.
    <dt><strong>-T</strong> <em>endtime</em>
    <dd>
      <p>Define the termination of a time window to restrict the samples retrieved from the <em>input</em> archives; refer to <strong>PCPIntro</strong>(1).
    <dt><strong>-v</strong> <em>volsamples</em>
    <dd>
      <p>The <em>output</em> archive is potentially a multi-volume data set, and the <strong>-v</strong> option causes <strong>pmlogreduce</strong> to start a new volume after <em>volsamples</em> log records have been written to the <em>output</em> archive.
      <div class="indent-7">
        <p>Independent of any <strong>-v</strong> option, each volume of an archive is limited to no more than 2^31 bytes, so <em>pmlogreduce</em> will automatically create a new volume for the archive before this limit is reached.
      </div>
    <dt><strong>-t</strong> <em>interval</em>
    <dd>
      <p>Consecutive samples in the <em>output</em> archive will appear with a time delta defined by <em>interval</em>; refer to <strong>PCPIntro</strong>(1). Note the default value is 600 (seconds, i.e. 10 minutes).
    <dt><strong>-Z</strong> <em>timezone</em>
    <dd>
      <p>Use <em>timezone</em> when displaying the date and time, or interpreting the <strong>-S</strong> and <strong>-T</strong> options. <em>Timezone</em> is in the format of the environment variable <strong>TZ</strong> as described in <strong>environ</strong>(7).
    <dt><strong>-z</strong>
    <dd>
      <p>Use the local timezone of the host from the <em>input</em> archives when displaying the date and time, or interpreting the <strong>-S</strong> and <strong>-T</strong> options. The default is to initially use the timezone of the local host.
  </dl>
</section>
<section>
  <h2>DATA REDUCTION</h2>
  <p>The statistical and temporal reduction follows the following rules:
  <dl class="indent-52">
    <dt>1.
    <dd>
      <p>Consecutive records from <em>input</em> are read without interpolation, and at most one output record is written for each <em>interval</em>, summarizing the performance data over that period.
    <dt>2.
    <dd>
      <p>If the semantics of a metric indicates it is <strong>instantaneous</strong> or <strong>discrete</strong> then <em>output</em> value is computed as the arithmetic mean of the observations (if any) over each <em>interval</em>.
    <dt>3.
    <dd>
      <p>If the semantics of a metric indicates it is a <strong>counter</strong> then the following transformations are applied:
      <dl class="indent-104">
        <dt>a)
        <dd>
          <p>Metrics with 32-bit precision are promoted to 64-bit precision.
        <dt>b)
        <dd>
          <p>Any counter wrap (overflow) is noted, and appropriate adjustment made in the value of the metric over each <em>interval</em>. This will be correct in the case of a single counter wrap, but will silently <strong>underestimate</strong> in the case where more than one counter wrap occurs between consecutive observations in the <em>input</em> archives, and silently <strong>overestimate</strong> in the case where a counter is reset occurs between consecutive observations in the <em>input</em> archives; unfortunately these situations cannot be detected, but are believed to be rare events for the sort of production monitoring environments where <strong>pmlogreduce</strong> is most likely to be deployed.
      </dl>
    <dt>4.
    <dd>
      <p>Any changes in instance domains, and indeed all metadata, is preserved.
    <dt>5.
    <dd>
      <p>Any ``mark'' records in the <em>input</em> archives (as created by <strong>pmlogextract</strong>(1)) will be preserved in the <em>output</em> archive, so periods where no data is available are maintained, and data interpolation will <strong>not</strong> occur across these periods when the <em>output</em> archive is subsequently processed with PCP applications.
  </dl>
</section>
<section>
  <h2>FILES</h2>
  <p>For each of the <em>input</em> and <em>output</em> archives, several physical files are used.
  <dl class="indent-10">
    <dt><em>archive</em><strong>.meta</strong>
    <dd>
      <p>metadata (metric descriptions, instance domains, etc.) for the archive log
    <dt><em>archive</em><strong>.0</strong>
    <dd>
      <p>initial volume of metrics values (subsequent volumes have suffixes <strong>1</strong>, <strong>2</strong>, ...) - for <em>input</em> these files may have been previously compressed with <strong>bzip2</strong>(1) or <strong>gzip</strong>(1) and thus may have an additional <strong>.bz2</strong> or <strong>.gz</strong> suffix.
    <dt><em>archive</em><strong>.index</strong>
    <dd>
      <p>temporal index to support rapid random access to the other files in the archive log.
  </dl>
</section>
<section>
  <h2>PCP ENVIRONMENT</h2>
  <p>Environment variables with the prefix <strong>PCP_</strong> are used to parameterize the file and directory names used by PCP. On each installation, the file <em>/etc/pcp.conf</em> contains the local values for these variables. The <strong>$PCP_CONF</strong> variable may be used to specify an alternative configuration file, as described in <strong>pcp.conf</strong>(5).
</section>
<section>
  <h2>SEE ALSO</h2>
  <p><strong>PCPIntro</strong>(1), <strong>pmdumplog</strong>(1), <strong>pmlc</strong>(1), <strong>pmlogextract</strong>(1), <strong>pmlogger</strong>(1), <strong>pcp.conf</strong>(5) and <strong>pcp.env</strong>(5).
</section>
<section>
  <h2>DIAGNOSTICS</h2>
  <p>All error conditions detected by <strong>pmlogreduce</strong> are reported on <em>stderr</em> with textual (if sometimes terse) explanation.
  <p>Should the <em>input</em> archives be corrupted (this can happen if the <strong>pmlogger</strong> instance writing the archive suddenly dies), then <strong>pmlogreduce</strong> will detect and report the position of the corruption in the file, and any subsequent information from the <em>input</em> archives will not be processed.
  <p>If any error is detected, <strong>pmlogreduce</strong> will exit with a non-zero status.
</section>
<section>
  <h2>CAVEATS</h2>
  <p>The preamble metrics (pmcd.pmlogger.archive, pmcd.pmlogger.host, and pmcd.pmlogger.port), which are automatically recorded by <strong>pmlogger</strong> at the start of the archive, may not be present in the archive output by <strong>pmlogreduce</strong>. These metrics are only relevant while the archive is being created, and have no significance once recording has finished.
</section>

